<html>
<head>
	<title></title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>
	<script src="https://d3js.org/d3.v4.min.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
	<link rel="stylesheet" href="styles.css">
	
	<script type="text/javascript" src='visDrawer.js'></script>
	<script type="text/javascript" src='treemapDrawer.js'></script>
	<script type="text/javascript" src='sunburstDrawer.js'></script>
	<!--<script type="text/javascript" src="flare.json"></script>-->
<script type="text/javascript" src='showVis.js'></script>

<script src="https://cdn.firebase.com/js/client/2.4.2/firebase.js"></script>	
<script src="https://www.gstatic.com/firebasejs/5.8.6/firebase.js"></script>
</head>
<body>
<div id="Sstartdots"></div>
<div id="Startdots2"></div>
	<div class ="container">

		<div id="DiffDescription"> <h3>Right panel shows the current visualization. Left panel shows the before and after changes in the visualization.</h3> </div>
			<!--visualizations go here-->
			<script type="text/javascript">

				var startime;
				var endtime;
				var config = {
				  apiKey: "AIzaSyCDvpYTQwRRPDmC-w3Quq5nSMmwruYQSt0",
				  authDomain: "hierarchical-269d0.firebaseapp.com",
				  databaseURL: "https://hierarchical-269d0.firebaseio.com",
				  projectId: "hierarchical-269d0",
				  storageBucket: "hierarchical-269d0.appspot.com",
				  messagingSenderId: "754209883401"
				};
				firebase.initializeApp(config);
				
				function writeUserInput(userId, session,ans,t) {
				  firebase.database().ref('answers/' + userId+'-'+currentindx).set({
				    session: session,
				    time: t,
				    answer: ans
				  }).then(function () {
						currentindx++;
				 		var states=personSarray[currentindx].split(",");
				 		compState=states[0];
				 		console.log(compState)
				 		visState=states[1];
				 		changeState=states[2];
				 		dataState=states[3];
			 			sessionStorage.setItem('myArray', myArray);
			 			localStorage.setItem('correctanswers',corrects)
			 			queryString = "?para1=" + currentindx;
			 			window.location.href = compState+".html" + queryString;
						});
				}

		   		var queryString = decodeURIComponent(window.location.search);
		   	   	var currentStringindex=queryString.split("=")
		   	   	var currentindx=parseInt(currentStringindex[1])
		   	   	console.log(currentindx)
		   	    var personSarray=[];
		   	    var myArray=[];
		   	   	var compState,visState,changeState,dataState;
			 	window.onload = function() {
			 		var f=new Date();
				 		startime=f.getTime();
 			 		 myArray= sessionStorage.getItem('myArray');
 			 		console.log(myArray)
 			 		personSarray=myArray.split("DOT,")
 			 		console.log(personSarray)
 			 		var states=personSarray[currentindx].split(",");
 			 		compState=states[0];
 			 		visState=states[1];
 			 		changeState=states[2];
 			 		dataState=states[3];
 			 		if (visState=="treemap"||visState=="tree"){
 			 			document.getElementById('Sstartdots').style.display='none';
 			 			document.getElementById('Startdots2').style.display='none';
 			 		}
 			 		updateVis("#viscontainer","#viscontainer",compState,visState,changeState,dataState)
			 //updateVis("#viscontainerafter","#viscontainerafter","Diff","sunburst","delete","small")
			 	}
			 	function submitAnswer(){
				 		
				 		var empt =document.getElementById('label').value;
					 	if (empt =="" || $('input[name=change]:checked').length <= 0)
					 	{
					 		if (empt ==""){
					 		  $('#label').css('border-color', 'red'); 
					 		  alert("Please enter node label");
					 		}
					 		else { 
					 		   	$('#label').css('border-color', '');
					 		}
					 		if ($('input[name=change]:checked').length <= 0){
					 				alert("Change type is not selected!");
					 		}
					 		
					 		
					 	}else {
					 		var radioValue = $("input[name='change']:checked").val();
					 		var textvalue = document.getElementById('label').value;
					 		var node;
					 		if (changeState=="add")
					 			node=newnode.data.name;
					 		else
					 			node=sourceNode.data.name
					 
					 		var correctanswer=checkUserInput(radioValue,textvalue,node);
					 		console.log(correctanswer)
					 		var d = new Date();
  							endtime = d.getTime();
					 		corrects = localStorage.getItem('correctanswers');
					 		if (correctanswer)
					 			corrects++;
					 		if (currentindx+1 >= personSarray.length){
					 			alert("Thank you for participating. Your session is over! Total Number of correct answers:"+corrects)
					 		}else{
					 			alert("press ok to move to the next task")
					 		}
					 		var currentuser=localStorage.getItem('userid');
					 		spentime=endtime-startime;
					 		writeUserInput(currentuser,personSarray[currentindx],correctanswer,spentime)
					 	}
				 		
				 	}
				 	function checkUserInput(r,t,name)
				 	{
				 		console.log(r)
				 		console.log(t)
				 		console.log(sourceNode)
					 	if (r==changeState && t ==name)
					 		return true;
					 	else
					 		return false;
				 		
				 	}


			</script>
			<div id ="currentvis"> Current Visualization</div>
			<div id ="beforesmalldiff"> Before</div>
			<div id ="aftersmalldiff"> After</div>
			<div id="viscontainerafter">	
			</div>
			<div id="diffshow">
				
				<div id="beforediff"><div id="startdots"></div></div>
				
				<div id="afterdiff"><div id="startdots2"></div></div>
				 
			</div>
			 
				 	   <div class="col-xs-2" id="labelbar">
				 	       <label for="ex1">Node:</label>
				 	       <input class="form-control" id="label" type="text" input autocomplete="off">
				 	     </div>
				 	
				  	<div class="questionbar" id="choices2">
				 		<div id="changes">
				 			
				 			<input type="radio"  name="change" value="add" input autocomplete="off"/>
				 				<label id="1choice">
				 					added
				     		  	</label></br>
				 		  	<input type="radio" name="change" value="delete" input autocomplete="off">
				 			  <label id="2choice">
				 			  	deleted
				     		  </label></br>
				 			<input type="radio" name="change" value="move" input autocomplete="off"> 	
				 				<label id="3choice">
				 					moved
				     		  	</label></br>
				 		<input type="button" class ="btn btn-primary btn-sm" id="submit" value="submit" onclick="submitAnswer();">
				 		</div>
				 		
				 	
				 	</div> 
			</div>
	
	
</body>